package com.ralf.cardmanager.spider.task.divvypay.operation.cardtranscation;

import com.google.gson.JsonArray;
import com.google.gson.JsonObject;
import com.google.gson.JsonParser;
import com.jeesite.common.lang.StringUtils;
import com.ralf.cardmanager.spider.task.divvypay.config.DivvyPaySiteConfig;
import com.ralf.cardmanager.spider.task.divvypay.operation.base.BaseDivvyOperation;
import com.ralf.cardmanager.spider.util.Base64Util;
import lombok.val;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.Date;

@Service
@Scope("prototype")
public class GetCardTransactionsByCompanyId extends BaseDivvyOperation<GetCardTransactionsByCompanyIdRsp> {
    private String pageSizeStr = "arrayconnection:%s";

    public GetCardTransactionsByCompanyId init(String cardId, Date dateEnd, Date dateStart, Long pageSize, Long start, String type,String budgetId) throws Exception {
        val params = new String[]{
                (pageSize != null && pageSize > 0) ? String.valueOf(pageSize) : "10",
                config.getCompanyId(),
                StringUtils.isEmpty(type) || !type.equalsIgnoreCase("decline") ? "null" : "[\"DECLINE\"]",
                !StringUtils.isEmpty(budgetId) ?"[\""+budgetId+"\"]":"null",
                !StringUtils.isEmpty(cardId) ?"[\""+cardId+"\"]":"null",
                start!=null?"\"" + Base64Util.encodeStr(String.format(pageSizeStr, start != null && start > 0 ? String.valueOf(start) : "0")) + "\"":"null",
                dateEnd == null ? "null" : String.valueOf(dateEnd.getTime() / 1000),
                dateStart == null ? "null" : String.valueOf(dateStart.getTime() / 1000),

        };
//        params[5] = new BASE64Encoder().encode(String.format(pageSizeStr, (pageSize != null && pageSize > 0) ? String.valueOf(pageSize) : "10").getBytes());
        super.init(params);
        if (!StringUtils.isEmpty(type) && type.equalsIgnoreCase("decline")) {
//            defaultHeader.put("referer", " https://app.divvy.co/transactions/declined");
            defaultHeader.put("referer", String.format("https://app.divvy.co/companies/%s/transactions/declined",config.getCompanyId()));
        }
        return this;

    }

    public GetCardTransactionsByCompanyId(DivvyPaySiteConfig config) {
        super(config);
//        defaultHeader.put("referer", " https://app.divvy.co/transactions/pending-and-cleared");
        defaultHeader.put("referer", String.format("https://app.divvy.co/companies/%s/transactions/pending-and-cleared",config.getCompanyId()));

//        body = "{\"operationName\":\"GetCompanyTransactions_Transactions_Table\",\"variables\":{\"companyId\":\"%s\",\"sortColumn\":\"occurredAt\",\"types\":null,\"budgetId\":null,\"cardId\":%s,\"userId\":null,\"status\":null,\"after\":%s,\"amountMax\":null,\"amountMin\":null,\"before\":null,\"dateEnd\":%s,\"dateStart\":%s,\"filterTagValues\":null,\"first\":%s,\"last\":null,\"merchantName\":null,\"search\":null,\"sortDirection\":\"desc\",\"isReviewed\":null,\"isLocked\":null,\"syncStatus\":null,\"hasAllRequiredFieldsCompleted\":null},\"query\":\"query GetCompanyTransactions_Transactions_Table($companyId: ID!, $first: Int = 30, $after: String, $search: String, $userId: [ID], $budgetId: [ID], $cardId: [ID], $merchantName: String, $filterTagValues: [ID], $amountMin: Int, $amountMax: Int, $dateStart: Time, $dateEnd: Time, $sortDirection: String = \\\"desc\\\", $sortColumn: String, $reconciled: Boolean, $isReviewed: Boolean, $isLocked: Boolean, $syncStatus: [SyncStatus], $hasAllRequiredFieldsCompleted: Boolean, $sortTagType: ID, $types: [TransactionType], $status: [TransactionStatus]) {\\n  node(id: $companyId) {\\n    ... on Company {\\n      id\\n      transactions(first: $first, after: $after, search: $search, userId: $userId, budgetId: $budgetId, cardId: $cardId, merchantName: $merchantName, filterTagValues: $filterTagValues, amountMin: $amountMin, amountMax: $amountMax, dateStart: $dateStart, dateEnd: $dateEnd, sortDirection: $sortDirection, sortColumn: $sortColumn, reconciled: $reconciled, isReviewed: $isReviewed, isLocked: $isLocked, syncStatus: $syncStatus, hasAllRequiredFieldsCompleted: $hasAllRequiredFieldsCompleted, sortTagType: $sortTagType, types: $types, status: $status) {\\n        ...CompanyTransactions\\n        edges {\\n          node {\\n            ...ChildTransactions\\n            __typename\\n          }\\n          __typename\\n        }\\n        __typename\\n      }\\n      __typename\\n    }\\n    __typename\\n  }\\n}\\n\\nfragment ChildTransactions on Transaction {\\n  childTransactions(first: 100) {\\n    totalCount\\n    edges {\\n      node {\\n        id\\n        status\\n        accountingIntegrationTransactions {\\n          id\\n          syncStatus\\n          syncMessage\\n          integrationType\\n          __typename\\n        }\\n        __typename\\n      }\\n      __typename\\n    }\\n    __typename\\n  }\\n  __typename\\n}\\n\\nfragment CompanyTransactions on TransactionConnection {\\n  pageInfo {\\n    hasNextPage\\n    endCursor\\n    __typename\\n  }\\n  edges {\\n    node {\\n      id\\n      receipts {\\n        id\\n        url\\n        filename\\n        __typename\\n      }\\n      amount\\n      fees\\n      budget {\\n        id\\n        name\\n        userRole\\n        __typename\\n      }\\n      card {\\n        id\\n        cardType\\n        lastFour\\n        name\\n        deleted\\n        user {\\n          id\\n          avatarUrl\\n          displayName\\n          __typename\\n        }\\n        __typename\\n      }\\n      isParent\\n      merchantName\\n      cleanedMerchantName\\n      merchantLogoUrl\\n      clearedAt\\n      occurredAt\\n      isReconciled\\n      note\\n      status\\n      type\\n      declineReason\\n      accountingIntegrationTransactions {\\n        id\\n        syncStatus\\n        syncMessage\\n        integrationTxId\\n        integrationType\\n        integrationId\\n        __typename\\n      }\\n      reviews(includeDeleted: true) {\\n        id\\n        insertedAt\\n        deletedAt\\n        reviewer {\\n          id\\n          displayName\\n          __typename\\n        }\\n        __typename\\n      }\\n      tagValues(first: 1000) {\\n        edges {\\n          node {\\n            id\\n            value\\n            tagType {\\n              id\\n              name\\n              allowCustomValues\\n              deleted\\n              __typename\\n            }\\n            __typename\\n          }\\n          __typename\\n        }\\n        __typename\\n      }\\n      __typename\\n    }\\n    __typename\\n  }\\n  __typename\\n}\\n\"}";
        body = "{\"operationName\":\"GetCompanyTransactions_Transactions_Table\",\"variables\":{\"first\":%s,\"sortDirection\":\"asc\",\"companyId\":\"%s\",\"sortColumn\":\"occurredAt\",\"types\":%s,\"budgetId\":%s,\"cardId\":%s,\"userId\":null,\"status\":null,\"after\":%s,\"amountMax\":null,\"amountMin\":null,\"before\":null,\"dateEnd\":%s,\"dateStart\":%s,\"filterTagValues\":null,\"last\":null,\"merchantName\":null,\"search\":null,\"isReviewed\":null,\"isLocked\":null,\"syncStatus\":null,\"hasAllRequiredFieldsCompleted\":null},\"query\":\"query GetCompanyTransactions_Transactions_Table($companyId: ID!, $first: Int = 30, $after: String, $search: String, $userId: [ID], $budgetId: [ID], $cardId: [ID], $merchantName: String, $filterTagValues: [ID], $amountMin: Int, $amountMax: Int, $dateStart: Time, $dateEnd: Time, $sortDirection: String = \\\"desc\\\", $sortColumn: String, $reconciled: Boolean, $isReviewed: Boolean, $isLocked: Boolean, $syncStatus: [SyncStatus], $hasAllRequiredFieldsCompleted: Boolean, $sortTagType: ID, $types: [TransactionType], $status: [TransactionStatus]) {\\n  node(id: $companyId) {\\n    ... on Company {\\n      id\\n      transactions(first: $first, after: $after, search: $search, userId: $userId, budgetId: $budgetId, cardId: $cardId, merchantName: $merchantName, filterTagValues: $filterTagValues, amountMin: $amountMin, amountMax: $amountMax, dateStart: $dateStart, dateEnd: $dateEnd, sortDirection: $sortDirection, sortColumn: $sortColumn, reconciled: $reconciled, isReviewed: $isReviewed, isLocked: $isLocked, syncStatus: $syncStatus, hasAllRequiredFieldsCompleted: $hasAllRequiredFieldsCompleted, sortTagType: $sortTagType, types: $types, status: $status) {\\n        ...CompanyTransactions\\n        edges {\\n          node {\\n            ...ChildTransactions\\n            __typename\\n          }\\n          __typename\\n        }\\n        __typename\\n      }\\n      __typename\\n    }\\n    __typename\\n  }\\n}\\n\\nfragment ChildTransactions on Transaction {\\n  childTransactions(first: 100) {\\n    totalCount\\n    edges {\\n      node {\\n        id\\n        status\\n        accountingIntegrationTransactions {\\n          id\\n          syncStatus\\n          syncMessage\\n          integrationType\\n          __typename\\n        }\\n        __typename\\n      }\\n      __typename\\n    }\\n    __typename\\n  }\\n  __typename\\n}\\n\\nfragment CompanyTransactions on TransactionConnection {\\n  pageInfo {\\n    hasNextPage\\n    endCursor\\n    __typename\\n  }\\n  edges {\\n    node {\\n      id\\n      receipts {\\n        id\\n        url\\n        filename\\n        __typename\\n      }\\n      amount\\n      fees\\n      budget {\\n        id\\n        name\\n        userRole\\n        __typename\\n      }\\n      card {\\n        id\\n        cardType\\n        lastFour\\n        name\\n        deleted\\n        user {\\n          id\\n          avatarUrl\\n          displayName\\n          __typename\\n        }\\n        __typename\\n      }\\n      isParent\\n      merchantName\\n      cleanedMerchantName\\n      merchantLogoUrl\\n      clearedAt\\n      occurredAt\\n      isReconciled\\n      note\\n      status\\n      type\\n      declineReason\\n      accountingIntegrationTransactions {\\n        id\\n        syncStatus\\n        syncMessage\\n        integrationTxId\\n        integrationType\\n        integrationId\\n        __typename\\n      }\\n      reviews(includeDeleted: true) {\\n        id\\n        insertedAt\\n        deletedAt\\n        reviewer {\\n          id\\n          displayName\\n          __typename\\n        }\\n        __typename\\n      }\\n      tagValues(first: 1000) {\\n        edges {\\n          node {\\n            id\\n            value\\n            tagType {\\n              id\\n              name\\n              allowCustomValues\\n              deleted\\n              __typename\\n            }\\n            __typename\\n          }\\n          __typename\\n        }\\n        __typename\\n      }\\n      __typename\\n    }\\n    __typename\\n  }\\n  __typename\\n}\\n\"}";
    }

    //返回 {"data":{"node":{"transactions":{"pageInfo":{"hasNextPage":true,"endCursor":"YXJyYXljb25uZWN0aW9uOjI5","__typename":"PageInfo"},"edges":[{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[],"__typename":"TagValueConnection"},"status":"OPEN","reviews":[],"receipts":[],"occurredAt":1567353590,"note":null,"merchantName":"AMZN Mktp US","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/amazon.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246NDdlOWU2ZTYtNjAxNy00MTExLWE3N2QtZGNiMGQ1ODJkODll","fees":0,"declineReason":null,"clearedAt":1567353590,"cleanedMerchantName":"Amazon.com","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo1NTUzNA==","displayName":"Lily Wang","avatarUrl":null,"__typename":"User"},"name":"May","lastFour":"1312","id":"Q2FyZDo0MDM3NTA=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"HWDS0627","id":"QnVkZ2V0OjQxNDMy","__typename":"Budget"},"amount":180,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[{"node":{"value":"Entertainment","tagType":{"name":"Category","id":"VGFnVHlwZTo3OTQw","deleted":false,"allowCustomValues":false,"__typename":"TagType"},"id":"VGFnVmFsdWU6NDA5NTMw","__typename":"TagValue"},"__typename":"TagValueEdge"}],"__typename":"TagValueConnection"},"status":"COMPLETE","reviews":[],"receipts":[],"occurredAt":1567353590,"note":null,"merchantName":"FACEBK QJ84","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246MDY3NmJmNDItNDYwNi00NzcwLWJiNzAtYzMwMWY5YmM3MGM5","fees":0,"declineReason":null,"clearedAt":1567353590,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B8-12-xd7","lastFour":"2735","id":"Q2FyZDozNjc2ODk=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":100,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[],"__typename":"TagValueConnection"},"status":"OPEN","reviews":[],"receipts":[],"occurredAt":1567353446,"note":null,"merchantName":"AMZN Mktp US","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/amazon.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246MTJmZTFkN2EtYWZhYy00MjI4LThjNjAtODgyZWVlMjgyNDlh","fees":0,"declineReason":null,"clearedAt":1567353446,"cleanedMerchantName":"Amazon.com","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo1NTUzNA==","displayName":"Lily Wang","avatarUrl":null,"__typename":"User"},"name":"Alice","lastFour":"4169","id":"Q2FyZDo0MDM3Mzc=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"HWDS0627","id":"QnVkZ2V0OjQxNDMy","__typename":"Budget"},"amount":180,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[],"__typename":"TagValueConnection"},"status":"OPEN","reviews":[],"receipts":[],"occurredAt":1567353425,"note":null,"merchantName":"AMZN Mktp US","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/amazon.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246NjA0ODMzZmMtOGRlNC00M2FiLWI0OTItYWE1MDIwNmY5ZjQy","fees":0,"declineReason":null,"clearedAt":1567353425,"cleanedMerchantName":"Amazon.com","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo1NTUzNA==","displayName":"Lily Wang","avatarUrl":null,"__typename":"User"},"name":"Gloria","lastFour":"3583","id":"Q2FyZDo0MDM3Mzg=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"HWDS0627","id":"QnVkZ2V0OjQxNDMy","__typename":"Budget"},"amount":180,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[],"__typename":"TagValueConnection"},"status":"OPEN","reviews":[],"receipts":[],"occurredAt":1567353390,"note":null,"merchantName":"AMZN Mktp US","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/amazon.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246ZjY3OTM3MGItNDlhNy00ZmRlLTg1MTYtZTVkMjk2YzJhYjg4","fees":0,"declineReason":null,"clearedAt":1567353390,"cleanedMerchantName":"Amazon.com","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo1NTUzNA==","displayName":"Lily Wang","avatarUrl":null,"__typename":"User"},"name":"Fred","lastFour":"7368","id":"Q2FyZDo0MDM3NDE=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"HWDS0627","id":"QnVkZ2V0OjQxNDMy","__typename":"Budget"},"amount":180,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[],"__typename":"TagValueConnection"},"status":"OPEN","reviews":[],"receipts":[],"occurredAt":1567353334,"note":null,"merchantName":"FACEBK *FC83EPARW2","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246MzdkZWFkNDUtODRkNC00ZWQwLWI3YTctMzc2ODdiMTE1ZWFm","fees":0,"declineReason":null,"clearedAt":1567353334,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B8-30-XL6","lastFour":"9508","id":"Q2FyZDo0MDIwNDg=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":17500,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[],"__typename":"TagValueConnection"},"status":"OPEN","reviews":[],"receipts":[],"occurredAt":1567353322,"note":null,"merchantName":"AMZN Mktp US","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/amazon.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246OTcxNDgzODQtNDA1MC00NzEzLThiN2ItYTY4MDEzZjcwMDZk","fees":0,"declineReason":null,"clearedAt":1567353322,"cleanedMerchantName":"Amazon.com","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo1NTUzNA==","displayName":"Lily Wang","avatarUrl":null,"__typename":"User"},"name":"Diego","lastFour":"2302","id":"Q2FyZDo0MDM3NDc=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"HWDS0627","id":"QnVkZ2V0OjQxNDMy","__typename":"Budget"},"amount":180,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[{"node":{"value":"Subscriptions","tagType":{"name":"Category","id":"VGFnVHlwZTo3OTQw","deleted":false,"allowCustomValues":false,"__typename":"TagType"},"id":"VGFnVmFsdWU6NDA5NTQw","__typename":"TagValue"},"__typename":"TagValueEdge"}],"__typename":"TagValueConnection"},"status":"COMPLETE","reviews":[],"receipts":[],"occurredAt":1567353312,"note":null,"merchantName":"Amazon Prime","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/amazon.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246Y2IxZjM3NmYtOTg1Ny00ZjZmLTkzMjYtZWU3NDY0MDM0YTA3","fees":0,"declineReason":null,"clearedAt":1567353312,"cleanedMerchantName":"Amazon Prime","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo1OTUzNg==","displayName":"hema sheng","avatarUrl":null,"__typename":"User"},"name":"Cristian Ortega","lastFour":"3076","id":"Q2FyZDozNTA3OTM=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"hemasheng0722","id":"QnVkZ2V0OjQ2OTUx","__typename":"Budget"},"amount":1400,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[],"__typename":"TagValueConnection"},"status":"OPEN","reviews":[],"receipts":[],"occurredAt":1567353265,"note":null,"merchantName":"AMZN Mktp US","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/amazon.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246ODhlZmIzMmItY2JiMy00MTliLTllOTYtZTYzMzI5NmMzM2E1","fees":0,"declineReason":null,"clearedAt":1567353265,"cleanedMerchantName":"Amazon.com","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo1NTUzNA==","displayName":"Lily Wang","avatarUrl":null,"__typename":"User"},"name":"May","lastFour":"1312","id":"Q2FyZDo0MDM3NTA=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"HWDS0627","id":"QnVkZ2V0OjQxNDMy","__typename":"Budget"},"amount":180,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[],"__typename":"TagValueConnection"},"status":"OPEN","reviews":[],"receipts":[],"occurredAt":1567353210,"note":null,"merchantName":"FACEBK H9XCENAVJ2","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246MTA3NjE4NDYtZTAzZC00NjhiLTg0YmUtNjU5NWQxNzA1MzM4","fees":0,"declineReason":null,"clearedAt":1567353210,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B8-29YJ1","lastFour":"4520","id":"Q2FyZDozOTk3NTQ=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":17500,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[],"__typename":"TagValueConnection"},"status":"OPEN","reviews":[],"receipts":[],"occurredAt":1567353201,"note":null,"merchantName":"AMZN Mktp US","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/amazon.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246NjU5MjRhYjgtNzEzZC00YmQ5LWI5NTYtN2Y4ZDY4OWQzZWJj","fees":0,"declineReason":null,"clearedAt":1567353201,"cleanedMerchantName":"Amazon.com","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo1NTUzNA==","displayName":"Lily Wang","avatarUrl":null,"__typename":"User"},"name":"Abel","lastFour":"1569","id":"Q2FyZDo0MDM3NDk=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"HWDS0627","id":"QnVkZ2V0OjQxNDMy","__typename":"Budget"},"amount":180,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[{"node":{"value":"Entertainment","tagType":{"name":"Category","id":"VGFnVHlwZTo3OTQw","deleted":false,"allowCustomValues":false,"__typename":"TagType"},"id":"VGFnVmFsdWU6NDA5NTMw","__typename":"TagValue"},"__typename":"TagValueEdge"}],"__typename":"TagValueConnection"},"status":"COMPLETE","reviews":[],"receipts":[],"occurredAt":1567353183,"note":null,"merchantName":"FACEBK *PP6ADME622","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246MzQ3N2U4MTItZjJjNS00YTY5LTgxYzAtMjVhZjhkNGM3NWFl","fees":0,"declineReason":null,"clearedAt":1567353183,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B8-26-xd9","lastFour":"8002","id":"Q2FyZDozOTIzOTY=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":2500,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[{"node":{"value":"Entertainment","tagType":{"name":"Category","id":"VGFnVHlwZTo3OTQw","deleted":false,"allowCustomValues":false,"__typename":"TagType"},"id":"VGFnVmFsdWU6NDA5NTMw","__typename":"TagValue"},"__typename":"TagValueEdge"}],"__typename":"TagValueConnection"},"status":"COMPLETE","reviews":[],"receipts":[],"occurredAt":1567352874,"note":null,"merchantName":"FACEBK *26HKCPNWJ2","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246MGE0Njc3ZmYtZGY3My00NWU3LTgxNjEtM2Q3M2Y4ODFhZjEw","fees":0,"declineReason":null,"clearedAt":1567352874,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B9-1-wr1","lastFour":"4793","id":"Q2FyZDo0MDMzNzA=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":4251,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[],"__typename":"TagValueConnection"},"status":"OPEN","reviews":[],"receipts":[],"occurredAt":1567352852,"note":null,"merchantName":"FACEBK *ZVHAXLJ292","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246NGQ3Zjg5NTctNzBiNC00ODAxLWJhNWEtYmZlYmQ2ZTg5NjYy","fees":0,"declineReason":null,"clearedAt":1567352852,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B8-29yj2","lastFour":"0900","id":"Q2FyZDozOTk3NTk=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":478,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[{"node":{"value":"Entertainment","tagType":{"name":"Category","id":"VGFnVHlwZTo3OTQw","deleted":false,"allowCustomValues":false,"__typename":"TagType"},"id":"VGFnVmFsdWU6NDA5NTMw","__typename":"TagValue"},"__typename":"TagValueEdge"}],"__typename":"TagValueConnection"},"status":"COMPLETE","reviews":[],"receipts":[],"occurredAt":1567352836,"note":null,"merchantName":"FACEBK *HG798MNH42","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246NzBlZDY5MmMtZTZhYS00MGEyLWJhYTYtYjE3ZDE2YzU4Njg4","fees":0,"declineReason":null,"clearedAt":1567352836,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B8-15-xl4","lastFour":"1289","id":"Q2FyZDozNzM1OTI=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":3500,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[],"__typename":"TagValueConnection"},"status":"OPEN","reviews":[],"receipts":[],"occurredAt":1567352799,"note":null,"merchantName":"FACEBK *CVHAXLJ292","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246MWRlYzkyZGYtNWMxMi00MzFjLTk2ZjktMGQzOTdkZWY0M2Ix","fees":0,"declineReason":null,"clearedAt":1567352799,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B8-29yj2","lastFour":"0900","id":"Q2FyZDozOTk3NTk=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":3500,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[],"__typename":"TagValueConnection"},"status":"OPEN","reviews":[],"receipts":[],"occurredAt":1567352610,"note":null,"merchantName":"FACEBK YDLS7N6VJ2","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246YWZmMTc5YTctOTQ1Ny00NjA0LWFmMGYtMmZlMmQ2MTQ0ZWE2","fees":0,"declineReason":null,"clearedAt":1567352610,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B8-29YJ1","lastFour":"4520","id":"Q2FyZDozOTk3NTQ=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":12500,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[{"node":{"value":"Entertainment","tagType":{"name":"Category","id":"VGFnVHlwZTo3OTQw","deleted":false,"allowCustomValues":false,"__typename":"TagType"},"id":"VGFnVmFsdWU6NDA5NTMw","__typename":"TagValue"},"__typename":"TagValueEdge"}],"__typename":"TagValueConnection"},"status":"COMPLETE","reviews":[],"receipts":[],"occurredAt":1567352586,"note":null,"merchantName":"FACEBK 2C7JMNEGR2","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246ZmYxMjNkMzAtYWQ0My00OTNmLWE3NGItNDg3YzM2YTI1N2E5","fees":0,"declineReason":null,"clearedAt":1567352586,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B8-wyx5","lastFour":"1617","id":"Q2FyZDozNzY2MDU=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":2500,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[],"__typename":"TagValueConnection"},"status":"OPEN","reviews":[],"receipts":[],"occurredAt":1567352319,"note":null,"merchantName":"Amazon Prime","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/amazon.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246YzIzMGRjMjYtNGI3OC00ZGRjLWE0MTQtNDZiMmQ4ZTI2MDRj","fees":0,"declineReason":null,"clearedAt":1567352319,"cleanedMerchantName":"Amazon Prime","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo1Njc2NA==","displayName":"Josh Bruce","avatarUrl":null,"__typename":"User"},"name":"J16","lastFour":"6288","id":"Q2FyZDozNTA2MzM=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"JCWLKJ0704","id":"QnVkZ2V0OjQ0ODc4","__typename":"Budget"},"amount":1400,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[{"node":{"value":"Entertainment","tagType":{"name":"Category","id":"VGFnVHlwZTo3OTQw","deleted":false,"allowCustomValues":false,"__typename":"TagType"},"id":"VGFnVmFsdWU6NDA5NTMw","__typename":"TagValue"},"__typename":"TagValueEdge"}],"__typename":"TagValueConnection"},"status":"COMPLETE","reviews":[],"receipts":[],"occurredAt":1567352290,"note":null,"merchantName":"FACEBK *A6X2ZLS762","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246NWZjZWNmNDgtNWM2Yi00Zjk0LWEzZmMtZDU4YzVhYTEzYjMx","fees":0,"declineReason":null,"clearedAt":1567352290,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B8-WYX6","lastFour":"7276","id":"Q2FyZDozOTM0MjM=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":7500,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[{"node":{"value":"Entertainment","tagType":{"name":"Category","id":"VGFnVHlwZTo3OTQw","deleted":false,"allowCustomValues":false,"__typename":"TagType"},"id":"VGFnVmFsdWU6NDA5NTMw","__typename":"TagValue"},"__typename":"TagValueEdge"}],"__typename":"TagValueConnection"},"status":"COMPLETE","reviews":[],"receipts":[],"occurredAt":1567352087,"note":null,"merchantName":"FACEBK *45FWRN2UR2","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246MjY3M2U3MjItNTEyZi00YThjLTg1MWItZmJmOGNhNjQ2N2Nk","fees":0,"declineReason":null,"clearedAt":1567352087,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2NDA5MA==","displayName":"Steven Wang","avatarUrl":null,"__typename":"User"},"name":"K50","lastFour":"1169","id":"Q2FyZDo0MDMzOTE=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"swang","id":"QnVkZ2V0OjQ5ODAz","__typename":"Budget"},"amount":4266,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[{"node":{"value":"Entertainment","tagType":{"name":"Category","id":"VGFnVHlwZTo3OTQw","deleted":false,"allowCustomValues":false,"__typename":"TagType"},"id":"VGFnVmFsdWU6NDA5NTMw","__typename":"TagValue"},"__typename":"TagValueEdge"}],"__typename":"TagValueConnection"},"status":"COMPLETE","reviews":[],"receipts":[],"occurredAt":1567352037,"note":null,"merchantName":"FACEBK *W7GQ3PAWJ2","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246ZjE2MmZlMjItZWJkMC00ZTZiLThkMjEtMjk0MDZkNTZkZTk5","fees":0,"declineReason":null,"clearedAt":1567352037,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B9-1-wr1","lastFour":"4793","id":"Q2FyZDo0MDMzNzA=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":3500,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[],"__typename":"TagValueConnection"},"status":"OPEN","reviews":[],"receipts":[],"occurredAt":1567352010,"note":null,"merchantName":"FACEBK LTFH3NWUJ2","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246OWU1Mzg4MzUtNGM5ZC00Y2YzLTg2NzYtMmEzZGI4NDUyNGQ0","fees":0,"declineReason":null,"clearedAt":1567352010,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B8-29YJ1","lastFour":"4520","id":"Q2FyZDozOTk3NTQ=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":7500,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[{"node":{"value":"Entertainment","tagType":{"name":"Category","id":"VGFnVHlwZTo3OTQw","deleted":false,"allowCustomValues":false,"__typename":"TagType"},"id":"VGFnVmFsdWU6NDA5NTMw","__typename":"TagValue"},"__typename":"TagValueEdge"}],"__typename":"TagValueConnection"},"status":"COMPLETE","reviews":[],"receipts":[],"occurredAt":1567351991,"note":null,"merchantName":"FACEBK W01U","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246YjMyN2UyNTItOTQ4MS00MDMwLTliNDQtMGUxZTU5NTE4M2Q1","fees":0,"declineReason":null,"clearedAt":1567351991,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B8-13-zj3","lastFour":"7185","id":"Q2FyZDozNjkzMDY=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":-100,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[],"__typename":"TagValueConnection"},"status":"OPEN","reviews":[],"receipts":[],"occurredAt":1567351711,"note":null,"merchantName":"FACEBK *8826WLA292","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246NjFjYWY2OTEtMDIyMy00MTNiLWJiYzYtMjFlNjk3ODVhNjFl","fees":0,"declineReason":null,"clearedAt":1567351711,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B8-29yj2","lastFour":"0900","id":"Q2FyZDozOTk3NTk=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":2500,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[],"__typename":"TagValueConnection"},"status":"OPEN","reviews":[],"receipts":[],"occurredAt":1567351670,"note":null,"merchantName":"FACEBK *3NWY7MAND2","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246Mzg1YzVhNDctZThiNy00NGJhLWI2NTItNzc3ZmVmODZlYzMw","fees":0,"declineReason":null,"clearedAt":1567351670,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2NDA5MA==","displayName":"Steven Wang","avatarUrl":null,"__typename":"User"},"name":"B50","lastFour":"1367","id":"Q2FyZDo0MDMzODE=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"swang","id":"QnVkZ2V0OjQ5ODAz","__typename":"Budget"},"amount":3500,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[{"node":{"value":"Entertainment","tagType":{"name":"Category","id":"VGFnVHlwZTo3OTQw","deleted":false,"allowCustomValues":false,"__typename":"TagType"},"id":"VGFnVmFsdWU6NDA5NTMw","__typename":"TagValue"},"__typename":"TagValueEdge"}],"__typename":"TagValueConnection"},"status":"COMPLETE","reviews":[],"receipts":[],"occurredAt":1567351521,"note":null,"merchantName":"FACEBK *LX4T7N2NY2","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246YmI4ZDg1MGMtYTAxYy00YzIzLTg5NTQtZmUzNzJhZDMxY2Zk","fees":0,"declineReason":null,"clearedAt":1567351521,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B8-27-ww02","lastFour":"5798","id":"Q2FyZDozOTM5NzE=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":5000,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[{"node":{"value":"Entertainment","tagType":{"name":"Category","id":"VGFnVHlwZTo3OTQw","deleted":false,"allowCustomValues":false,"__typename":"TagType"},"id":"VGFnVmFsdWU6NDA5NTMw","__typename":"TagValue"},"__typename":"TagValueEdge"}],"__typename":"TagValueConnection"},"status":"COMPLETE","reviews":[],"receipts":[],"occurredAt":1567351507,"note":null,"merchantName":"FACEBK 0IAO","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246NzdkYzJmYmEtN2QwNC00YWRlLWI2YTgtYmRiNGRiMDcwMzMz","fees":0,"declineReason":null,"clearedAt":1567351507,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B8-26-xd10","lastFour":"0079","id":"Q2FyZDozOTIzOTc=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":-100,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[{"node":{"value":"Entertainment","tagType":{"name":"Category","id":"VGFnVHlwZTo3OTQw","deleted":false,"allowCustomValues":false,"__typename":"TagType"},"id":"VGFnVmFsdWU6NDA5NTMw","__typename":"TagValue"},"__typename":"TagValueEdge"}],"__typename":"TagValueConnection"},"status":"COMPLETE","reviews":[],"receipts":[],"occurredAt":1567351490,"note":null,"merchantName":"FACEBK *34GQ3PAWJ2","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246NTRjMTZjMjUtZmU0Mi00NWI3LWJmOWQtZTBlMDk0OWFiYWRk","fees":0,"declineReason":null,"clearedAt":1567351490,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B9-1-wr1","lastFour":"4793","id":"Q2FyZDo0MDMzNzA=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":3067,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"},{"node":{"type":"AUTHORIZATION","tagValues":{"edges":[{"node":{"value":"Entertainment","tagType":{"name":"Category","id":"VGFnVHlwZTo3OTQw","deleted":false,"allowCustomValues":false,"__typename":"TagType"},"id":"VGFnVmFsdWU6NDA5NTMw","__typename":"TagValue"},"__typename":"TagValueEdge"}],"__typename":"TagValueConnection"},"status":"COMPLETE","reviews":[],"receipts":[],"occurredAt":1567351439,"note":null,"merchantName":"FACEBK *ZKRAKN6WJ2","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","isReconciled":false,"isParent":false,"id":"VHJhbnNhY3Rpb246ZjAzMWY1NDQtZjJjYS00ZGUwLWJiNjgtMmVlMWIzY2UyZmU2","fees":0,"declineReason":null,"clearedAt":1567351439,"cleanedMerchantName":"Facebook","childTransactions":{"totalCount":0,"edges":[],"__typename":"TransactionConnection"},"card":{"user":{"id":"VXNlcjo2MjgzMA==","displayName":"Steven Wong","avatarUrl":null,"__typename":"User"},"name":"B9-1-wr1","lastFour":"4793","id":"Q2FyZDo0MDMzNzA=","deleted":false,"cardType":"SUBSCRIPTION","__typename":"Card"},"budget":{"userRole":"ADMIN","name":"mystery0804","id":"QnVkZ2V0OjQ4OTEy","__typename":"Budget"},"amount":2500,"accountingIntegrationTransactions":null,"__typename":"Transaction"},"__typename":"TransactionEdge"}],"__typename":"TransactionConnection"},"id":"Q29tcGFueTozMDI3","__typename":"Company"}}}
    @Override
    public GetCardTransactionsByCompanyIdRsp persistent(String rsp) {
        //data.node.transactions.edges
        JsonObject jsonObject = new JsonParser().parse(rsp).getAsJsonObject().get("data").getAsJsonObject().get("node").getAsJsonObject().get("transactions").getAsJsonObject();
        JsonArray jsonArray = jsonObject.getAsJsonObject().get("edges").getAsJsonArray();
        val list = new ArrayList<GetCardTransactionsByCompanyIdRspDetail>();
        jsonArray.forEach(t -> {
            val node = t.getAsJsonObject().get("node").getAsJsonObject();
            Long occurredAt = node.get("occurredAt").getAsLong();
            Long amount = node.get("amount").getAsLong();
            Long clearedAt = node.get("clearedAt").getAsLong();
            String transactionId = node.get("id").getAsString();
            String status = node.get("status").getAsString();
            String type = node.get("type").getAsString();
            String merchantLogo = node.get("merchantLogoUrl").isJsonNull() ? "" : node.get("merchantLogoUrl").getAsString();
            String merchantName = node.get("merchantName").isJsonNull() ? "" : node.get("merchantName").getAsString();
            String clearMerchantName = node.get("cleanedMerchantName").isJsonNull() ? "" : node.get("cleanedMerchantName").getAsString();
            String declineReason = node.get("declineReason").isJsonNull() ? "" : node.get("declineReason").getAsString();
            Long fee = node.get("fees").isJsonNull() ? 0l : node.get("fees").getAsLong();
            String cardId = node.get("card").getAsJsonObject().get("id").getAsString();
            list.add(new GetCardTransactionsByCompanyIdRspDetail(
                    transactionId, type, status, clearMerchantName, amount, new Date(clearedAt * 1000), new Date(occurredAt * 1000), declineReason, cardId, fee, merchantLogo, merchantName
            ));
        });
        val hasNextPage = jsonObject.get("pageInfo").getAsJsonObject().get("hasNextPage").getAsBoolean();
        val endCursor = jsonObject.get("pageInfo").getAsJsonObject().get("endCursor").isJsonNull()?null:jsonObject.get("pageInfo").getAsJsonObject().get("endCursor").getAsString();
        return new GetCardTransactionsByCompanyIdRsp(hasNextPage, endCursor!=null?Base64Util.toNameValuePair(endCursor).getValue():null, list);
    }
}

