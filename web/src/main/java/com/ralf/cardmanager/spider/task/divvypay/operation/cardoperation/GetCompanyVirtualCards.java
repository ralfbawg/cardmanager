package com.ralf.cardmanager.spider.task.divvypay.operation.cardoperation;

import com.google.gson.JsonObject;
import com.google.gson.JsonParser;
import com.jeesite.common.lang.StringUtils;
import com.mchange.util.Base64Encoder;
import com.ralf.cardmanager.spider.task.divvypay.config.DivvyPaySiteConfig;
import com.ralf.cardmanager.spider.task.divvypay.operation.base.BaseDivvyOperation;
import com.ralf.cardmanager.spider.task.divvypay.operation.base.BaseDivvyOpertionResp;
import com.ralf.cardmanager.spider.util.Base64Util;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.val;
import org.springframework.context.annotation.Scope;
import org.springframework.stereotype.Service;

import java.util.ArrayList;
import java.util.List;

@Service
@Scope("prototype")
public class GetCompanyVirtualCards extends BaseDivvyOperation<GetCompanyVirtualCardsRsp> {
    private String pageParam = "arrayconnection:%s";
    private String size = "20";
    private String start = "0";

    public GetCompanyVirtualCards init(String sizeParam, String startParam) throws Exception {
        val sizeParam2 = Base64Util.encodeStr(StringUtils.isEmpty(sizeParam) ? size : sizeParam);
        val startParam2 = Base64Util.encodeStr(StringUtils.isEmpty(startParam) ? start : startParam);
        super.init(new String[]{config.getCompanyId(), sizeParam2, startParam2});
        return this;
    }

    public GetCompanyVirtualCards(DivvyPaySiteConfig config) {
        super(config);
        defaultHeader.put("referer", "https://app.divvy.co/cards");
//        body = "{\"operationName\":\"GetCompanyVirtualCards\",\"variables\":{\"companyId\":\"%s\",\"first\":%s,\"types\":[\"BURNER\",\"SUBSCRIPTION\",\"RECURRING\"],\"sortColumn\":\"name\",\"sortDirection\":\"desc\"},\"query\":\"query GetCompanyVirtualCards($companyId: ID!, $after: String, $budgets: [ID], $first: Int, $merchants: [String], $owners: [ID], $search: String, $sortColumn: String, $sortDirection: String, $types: [UserCardType]) {\\n  node(id: $companyId) {\\n    ... on Company {\\n      id\\n      allCards(first: $first, after: $after, types: $types, merchants: $merchants, owners: $owners, budgets: $budgets, search: $search, sortColumn: $sortColumn, sortDirection: $sortDirection) {\\n        totalCount\\n        pageInfo {\\n          hasNextPage\\n          endCursor\\n          __typename\\n        }\\n        edges {\\n          node {\\n            id\\n            ...VirtualCardsListCard\\n            ...VirtualCardsTableRow\\n            __typename\\n          }\\n          __typename\\n        }\\n        __typename\\n      }\\n      __typename\\n    }\\n    __typename\\n  }\\n}\\n\\nfragment VirtualCardsTableRow on Card {\\n  id\\n  name\\n  cardType\\n  latestTransaction {\\n    id\\n    merchantName\\n    cleanedMerchantName\\n    merchantLogoUrl\\n    clearedAt\\n    occurredAt\\n    __typename\\n  }\\n  user {\\n    id\\n    displayName\\n    firstName\\n    lastName\\n    avatarUrl\\n    __typename\\n  }\\n  userAllocation {\\n    id\\n    budget {\\n      id\\n      name\\n      retired\\n      __typename\\n    }\\n    __typename\\n  }\\n  __typename\\n}\\n\\nfragment VirtualCardsListCard on Card {\\n  id\\n  frozen\\n  lastFour\\n  name\\n  cardType\\n  user {\\n    id\\n    displayName\\n    firstName\\n    lastName\\n    avatarUrl\\n    __typename\\n  }\\n  userAllocation {\\n    id\\n    expiresAt\\n    type\\n    budget {\\n      id\\n      name\\n      __typename\\n    }\\n    __typename\\n  }\\n  __typename\\n}\\n\"}";
        body = "{\"operationName\":\"GetCompanyVirtualCards\",\"variables\":{\"companyId\":\"%s\",\"first\":%s,\"search\":\"\",\"excludeUsers\":[\"%s\"],\"types\":[\"BURNER\",\"SUBSCRIPTION\",\"RECURRING\"],\"sortColumn\":\"name\",\"sortDirection\":\"desc\",\"after\":\"%s\"},\"query\":\"query GetCompanyVirtualCards($companyId: ID!, $after: String, $budgets: [ID], $first: Int, $merchants: [String], $owners: [ID], $search: String, $sortColumn: String, $sortDirection: String, $types: [UserCardType], $excludeUsers: [ID]) {\\n  node(id: $companyId) {\\n    ... on Company {\\n      id\\n      allCards(first: $first, after: $after, types: $types, merchants: $merchants, owners: $owners, budgets: $budgets, search: $search, sortColumn: $sortColumn, sortDirection: $sortDirection, excludeUsers: $excludeUsers) {\\n        totalCount\\n        pageInfo {\\n          hasNextPage\\n          endCursor\\n          __typename\\n        }\\n        edges {\\n          node {\\n            id\\n            ...VirtualCardsListCard\\n            ...VirtualCardsTableRow\\n            __typename\\n          }\\n          __typename\\n        }\\n        __typename\\n      }\\n      __typename\\n    }\\n    __typename\\n  }\\n}\\n\\nfragment VirtualCardsTableRow on Card {\\n  id\\n  name\\n  cardType\\n  token\\n  expirationDate\\n  latestTransaction {\\n    id\\n    merchantName\\n    cleanedMerchantName\\n    merchantLogoUrl\\n    clearedAt\\n    occurredAt\\n    __typename\\n  }\\n  user {\\n    id\\n    displayName\\n    firstName\\n    lastName\\n    avatarUrl\\n    __typename\\n  }\\n  userAllocation {\\n    id\\n    budget {\\n      id\\n      name\\n      retired\\n      __typename\\n    }\\n    __typename\\n  }\\n  __typename\\n}\\n\\nfragment VirtualCardsListCard on Card {\\n  id\\n  frozen\\n  lastFour\\n  name\\n  cardType\\n  activationStatus\\n  blocked\\n  token\\n  expirationDate\\n  user {\\n    id\\n    displayName\\n    firstName\\n    lastName\\n    avatarUrl\\n    activeUserAllocation {\\n      id\\n      expiresAt\\n      type\\n      totalCleared\\n      totalPending\\n      availableFunds\\n      recurringAmount\\n      budget {\\n        id\\n        name\\n        balance\\n        __typename\\n      }\\n      __typename\\n    }\\n    __typename\\n  }\\n  userAllocation {\\n    id\\n    expiresAt\\n    type\\n    totalCleared\\n    totalPending\\n    availableFunds\\n    recurringAmount\\n    budget {\\n      id\\n      name\\n      balance\\n      __typename\\n    }\\n    __typename\\n  }\\n  __typename\\n}\\n\"}";
    }

    //{"data":{"node":{"id":"Q29tcGFueTozMDI3","allCards":{"totalCount":10248,"pageInfo":{"hasNextPage":true,"endCursor":"YXJyYXljb25uZWN0aW9uOjI5","__typename":"PageInfo"},"edges":[{"node":{"userAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":4447,"recurringAmount":0,"id":"VXNlckFsbG9jYXRpb246NDg5MDc5","expiresAt":1694793599,"budget":{"retired":false,"name":"Ben0730","id":"QnVkZ2V0OjQ4MDY2","balance":-2148,"__typename":"Budget"},"availableFunds":5553,"__typename":"UserAllocation"},"user":{"lastName":"Adam","id":"VXNlcjo2MTY2Nw==","firstName":"Ben","displayName":"Ben Adam","avatarUrl":null,"activeUserAllocation":null,"__typename":"User"},"token":"001.R.20190820015652815658","name":"0001","latestTransaction":{"occurredAt":1567502688,"merchantName":"AMZN MKTP DE*MA70Q60K4","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/amazon.png","id":"VHJhbnNhY3Rpb246YTQ1MzcyNGMtNzk1My00MjQ3LWIzYjEtYzI4NzVkMzIyMzc2","clearedAt":1567502688,"cleanedMerchantName":"Amazon.com","__typename":"Transaction"},"lastFour":"0823","id":"Q2FyZDozODEyOTI=","frozen":false,"expirationDate":"08/22","cardType":"BURNER","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":0,"recurringAmount":10,"id":"VXNlckFsbG9jYXRpb246NDk1OTI4","expiresAt":null,"budget":{"retired":false,"name":"Ben0730","id":"QnVkZ2V0OjQ4MDY2","balance":-2148,"__typename":"Budget"},"availableFunds":10,"__typename":"UserAllocation"},"user":{"lastName":"Adam","id":"VXNlcjo2MTY2Nw==","firstName":"Ben","displayName":"Ben Adam","avatarUrl":null,"activeUserAllocation":null,"__typename":"User"},"token":"001.R.20190822225529311321","name":"0002","latestTransaction":null,"lastFour":"6064","id":"Q2FyZDozODY5MDc=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":2289,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NDY3Mzcz","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":200,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190807165008686370","name":"002","latestTransaction":{"occurredAt":1566478101,"merchantName":"GOOGLE *GOOGLE FI","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/google.png","id":"VHJhbnNhY3Rpb246NTExYjZhYzktYjE0ZS00NWZjLWJmOTctMGU5NzBlZjk2Njc1","clearedAt":1566478101,"cleanedMerchantName":"Google Fi","__typename":"Transaction"},"lastFour":"4535","id":"Q2FyZDozNjI5Nzk=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":2289,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NDY3Mzgw","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":3000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190807165837407623","name":"003","latestTransaction":{"occurredAt":1566478102,"merchantName":"GOOGLE *GOOGLE FI","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/google.png","id":"VHJhbnNhY3Rpb246MjVkNTlhNGMtNWYzOS00NTRiLWEzMzQtODVjNTA5Y2NhYjZl","clearedAt":1566478102,"cleanedMerchantName":"Google Fi","__typename":"Transaction"},"lastFour":"8505","id":"Q2FyZDozNjI5OTU=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":2289,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NDY3Mzkx","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":200,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190807170712818243","name":"004","latestTransaction":{"occurredAt":1566478099,"merchantName":"GOOGLE *GOOGLE FI","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/google.png","id":"VHJhbnNhY3Rpb246ZjhiYjE2YmUtNzAzYy00MWJlLTg0M2YtN2JhYTBjNDBkMTYy","clearedAt":1566478099,"cleanedMerchantName":"Google Fi","__typename":"Transaction"},"lastFour":"3374","id":"Q2FyZDozNjMwMDQ=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":2289,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NDY3NDEx","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":3000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190807172112867603","name":"005","latestTransaction":{"occurredAt":1566478100,"merchantName":"GOOGLE *GOOGLE FI","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/google.png","id":"VHJhbnNhY3Rpb246MTRjYjFlYjQtM2E3MS00ODE2LWFhNjAtNTllMTMwMGQyMWE0","clearedAt":1566478100,"cleanedMerchantName":"Google Fi","__typename":"Transaction"},"lastFour":"4704","id":"Q2FyZDozNjMwMjM=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":2289,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NDY3NDIw","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":3000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190807172817931811","name":"006","latestTransaction":{"occurredAt":1566478104,"merchantName":"GOOGLE *GOOGLE FI","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/google.png","id":"VHJhbnNhY3Rpb246Y2FlMDM0MzUtN2IwMC00ZjZmLTg2ODAtZDM3NTdiNjNhNjNh","clearedAt":1566478104,"cleanedMerchantName":"Google Fi","__typename":"Transaction"},"lastFour":"0903","id":"Q2FyZDozNjMwMzE=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":2289,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NDY3NDI1","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":3000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190807173515043512","name":"007","latestTransaction":{"occurredAt":1566478101,"merchantName":"GOOGLE *GOOGLE FI","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/google.png","id":"VHJhbnNhY3Rpb246MjY5YWYyNjUtYTRlOC00ODZmLWIyZWUtMjZhYzk0ZGUyZGI2","clearedAt":1566478101,"cleanedMerchantName":"Google Fi","__typename":"Transaction"},"lastFour":"1505","id":"Q2FyZDozNjMwMzQ=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":2289,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NDY3NDUx","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":3000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190807182149580752","name":"009","latestTransaction":{"occurredAt":1566478104,"merchantName":"GOOGLE *GOOGLE FI","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/google.png","id":"VHJhbnNhY3Rpb246MzdhNmJmMDItNDZkNC00ZjRlLWIzN2MtZTAzY2Q1OThmZjk2","clearedAt":1566478104,"cleanedMerchantName":"Google Fi","__typename":"Transaction"},"lastFour":"1365","id":"Q2FyZDozNjMwNjc=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":2289,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NDY3NDUz","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":3000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190807182626558489","name":"010","latestTransaction":{"occurredAt":1566478105,"merchantName":"GOOGLE *GOOGLE FI","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/google.png","id":"VHJhbnNhY3Rpb246NmRmMDdmYjYtZmI5MC00NDljLWE2MDgtMTdhMzcwYTc0NmE0","clearedAt":1566478105,"cleanedMerchantName":"Google Fi","__typename":"Transaction"},"lastFour":"4994","id":"Q2FyZDozNjMwNzI=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":2289,"recurringAmount":1000,"id":"VXNlckFsbG9jYXRpb246NDY3NDU3","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":1000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190807183647918100","name":"011","latestTransaction":{"occurredAt":1566478099,"merchantName":"GOOGLE *GOOGLE FI","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/google.png","id":"VHJhbnNhY3Rpb246MWUwZGM4Y2EtODk5MS00ZmMzLTk5YzYtODgyOWMxZTkwNWE3","clearedAt":1566478099,"cleanedMerchantName":"Google Fi","__typename":"Transaction"},"lastFour":"7541","id":"Q2FyZDozNjMwNzc=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":2289,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NDY3NDU4","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":200,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190807184300347050","name":"012","latestTransaction":{"occurredAt":1566478100,"merchantName":"GOOGLE *GOOGLE FI","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/google.png","id":"VHJhbnNhY3Rpb246YWY1MTFjYWYtNzgyZi00OWQ5LTgwZjctMjE1MGU5NzNmNzFj","clearedAt":1566478100,"cleanedMerchantName":"Google Fi","__typename":"Transaction"},"lastFour":"2395","id":"Q2FyZDozNjMwNzg=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":2289,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NDc0MDEw","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":200,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190812075158650845","name":"013","latestTransaction":{"occurredAt":1566817823,"merchantName":"GOOGLE *GOOGLE FI","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/google.png","id":"VHJhbnNhY3Rpb246OWRhNGI4ZTAtOTc2ZC00MjVlLWE5N2QtMzU3NzEzMzlhMGFi","clearedAt":1566817823,"cleanedMerchantName":"Google Fi","__typename":"Transaction"},"lastFour":"6340","id":"Q2FyZDozNjg4MzU=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":2289,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NDc0MDA3","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":3000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190812073815083233","name":"014","latestTransaction":{"occurredAt":1566817825,"merchantName":"GOOGLE *GOOGLE FI","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/google.png","id":"VHJhbnNhY3Rpb246ODg0ODE1ZTItN2EzYy00ZTQ4LTlmZTUtMDVhYjg0MzEzY2Ji","clearedAt":1566817825,"cleanedMerchantName":"Google Fi","__typename":"Transaction"},"lastFour":"6989","id":"Q2FyZDozNjg4MzI=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":2289,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NDc5OTcw","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":3000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190815090021189770","name":"015","latestTransaction":{"occurredAt":1567075132,"merchantName":"GOOGLE*GOOGLE FI","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/google.png","id":"VHJhbnNhY3Rpb246MTczOGQ2NjctOTY1Ny00YTJkLWI5MzEtODA2MTFhYzg2ZTJl","clearedAt":1567075132,"cleanedMerchantName":"Google Fi","__typename":"Transaction"},"lastFour":"8617","id":"Q2FyZDozNzM2OTk=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":0,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NDk5NTA1","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":3000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190825052937372418","name":"016","latestTransaction":null,"lastFour":"1011","id":"Q2FyZDozODk5NTU=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":0,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NTAxNDIw","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":3000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190826024902515092","name":"017","latestTransaction":null,"lastFour":"7824","id":"Q2FyZDozOTE3Nzg=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":0,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NTAxNTI3","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":3000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190826025816759711","name":"018","latestTransaction":null,"lastFour":"9289","id":"Q2FyZDozOTE4ODI=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":0,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NTAxNTQz","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":3000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190826030254142580","name":"019","latestTransaction":null,"lastFour":"5406","id":"Q2FyZDozOTE4OTY=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":0,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NTAxNTc0","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":3000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190826032440043869","name":"020","latestTransaction":null,"lastFour":"8251","id":"Q2FyZDozOTE5Mjc=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":0,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NTAxNjE0","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":3000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190826034145308373","name":"021","latestTransaction":null,"lastFour":"4449","id":"Q2FyZDozOTE5Njc=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":0,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NTAxNjM0","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":3000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190826034942875636","name":"022","latestTransaction":null,"lastFour":"0844","id":"Q2FyZDozOTE5ODc=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":0,"recurringAmount":3000,"id":"VXNlckFsbG9jYXRpb246NTAxNjYz","expiresAt":null,"budget":{"retired":false,"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":3000,"__typename":"UserAllocation"},"user":{"lastName":"Miller","id":"VXNlcjo2MTI1Ng==","firstName":"Alienware","displayName":"Alienware Miller","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDQ5Nzg0","expiresAt":null,"budget":{"name":"SZBC0729","id":"QnVkZ2V0OjQ3ODE4","balance":878,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190826035826468008","name":"023","latestTransaction":null,"lastFour":"6821","id":"Q2FyZDozOTIwMTY=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":571909,"recurringAmount":0,"id":"VXNlckFsbG9jYXRpb246NDcyNjY4","expiresAt":null,"budget":{"retired":false,"name":"fboffer0811","id":"QnVkZ2V0OjQ5ODI4","balance":469150,"__typename":"Budget"},"availableFunds":13000,"__typename":"UserAllocation"},"user":{"lastName":"Gao","id":"VXNlcjo2NDEwNg==","firstName":"kinz","displayName":"kinz Gao","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDcyMzkw","expiresAt":null,"budget":{"name":"fboffer0811","id":"QnVkZ2V0OjQ5ODI4","balance":469150,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190811111233060143","name":"08.11zm01","latestTransaction":{"occurredAt":1565689514,"merchantName":"FACEBK *5AZ3LN6BS2","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","id":"VHJhbnNhY3Rpb246ZmRlNGM5MGMtZjVkNS00NjBmLTkzOGYtYmQxZmQwOTc4NjIz","clearedAt":1565689514,"cleanedMerchantName":"Facebook","__typename":"Transaction"},"lastFour":"0703","id":"Q2FyZDozNjc1ODQ=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":293442,"recurringAmount":1000,"id":"VXNlckFsbG9jYXRpb246NDcyNjc3","expiresAt":null,"budget":{"retired":false,"name":"fboffer0811","id":"QnVkZ2V0OjQ5ODI4","balance":469150,"__typename":"Budget"},"availableFunds":1000,"__typename":"UserAllocation"},"user":{"lastName":"Gao","id":"VXNlcjo2NDEwNg==","firstName":"kinz","displayName":"kinz Gao","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDcyMzkw","expiresAt":null,"budget":{"name":"fboffer0811","id":"QnVkZ2V0OjQ5ODI4","balance":469150,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190811122451793668","name":"08.11zm02","latestTransaction":{"occurredAt":1565689512,"merchantName":"FACEBK *4S7HBNS3K2","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","id":"VHJhbnNhY3Rpb246YmIwYzE3ZjItYzk0YS00NzcyLWJiYWItMjY3ZDI2MjU4N2Ex","clearedAt":1565689512,"cleanedMerchantName":"Facebook","__typename":"Transaction"},"lastFour":"6720","id":"Q2FyZDozNjc1OTQ=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":0,"recurringAmount":1000,"id":"VXNlckFsbG9jYXRpb246NDcyNjgw","expiresAt":null,"budget":{"retired":false,"name":"fboffer0811","id":"QnVkZ2V0OjQ5ODI4","balance":469150,"__typename":"Budget"},"availableFunds":1000,"__typename":"UserAllocation"},"user":{"lastName":"Gao","id":"VXNlcjo2NDEwNg==","firstName":"kinz","displayName":"kinz Gao","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDcyMzkw","expiresAt":null,"budget":{"name":"fboffer0811","id":"QnVkZ2V0OjQ5ODI4","balance":469150,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190811123502497030","name":"08.11zm03","latestTransaction":null,"lastFour":"2558","id":"Q2FyZDozNjc1OTc=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":13041,"recurringAmount":4000,"id":"VXNlckFsbG9jYXRpb246NDcyNzAw","expiresAt":null,"budget":{"retired":false,"name":"fboffer0811","id":"QnVkZ2V0OjQ5ODI4","balance":469150,"__typename":"Budget"},"availableFunds":4000,"__typename":"UserAllocation"},"user":{"lastName":"Gao","id":"VXNlcjo2NDEwNg==","firstName":"kinz","displayName":"kinz Gao","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDcyMzkw","expiresAt":null,"budget":{"name":"fboffer0811","id":"QnVkZ2V0OjQ5ODI4","balance":469150,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190811135000179772","name":"0812hpy02","latestTransaction":{"occurredAt":1565613880,"merchantName":"FACEBK *925RZNW2P2","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","id":"VHJhbnNhY3Rpb246ZWU0N2I3NzgtNjkwMi00NTRkLWIxYmQtZGJlMTAxMWE5MjFl","clearedAt":1565613880,"cleanedMerchantName":"Facebook","__typename":"Transaction"},"lastFour":"2711","id":"Q2FyZDozNjc2MTU=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":84764,"recurringAmount":4000,"id":"VXNlckFsbG9jYXRpb246NDczNzMy","expiresAt":null,"budget":{"retired":false,"name":"fboffer0811","id":"QnVkZ2V0OjQ5ODI4","balance":469150,"__typename":"Budget"},"availableFunds":4000,"__typename":"UserAllocation"},"user":{"lastName":"Gao","id":"VXNlcjo2NDEwNg==","firstName":"kinz","displayName":"kinz Gao","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDcyMzkw","expiresAt":null,"budget":{"name":"fboffer0811","id":"QnVkZ2V0OjQ5ODI4","balance":469150,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190811235557047772","name":"0812hpy04","latestTransaction":{"occurredAt":1565689520,"merchantName":"FACEBK *6K5EWMSMU2","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/facebook.png","id":"VHJhbnNhY3Rpb246MjFhYjI5OGItOTdiYy00MDkyLTg4NGItZDE2MmUzZjljNTc1","clearedAt":1565689520,"cleanedMerchantName":"Facebook","__typename":"Transaction"},"lastFour":"6739","id":"Q2FyZDozNjg1NjQ=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":0,"recurringAmount":1000,"id":"VXNlckFsbG9jYXRpb246NTA0MTQx","expiresAt":null,"budget":{"retired":false,"name":"fboffer0811","id":"QnVkZ2V0OjQ5ODI4","balance":469150,"__typename":"Budget"},"availableFunds":1000,"__typename":"UserAllocation"},"user":{"lastName":"Gao","id":"VXNlcjo2NDEwNg==","firstName":"kinz","displayName":"kinz Gao","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246NDcyMzkw","expiresAt":null,"budget":{"name":"fboffer0811","id":"QnVkZ2V0OjQ5ODI4","balance":469150,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190827014338972184","name":"08.27zm01","latestTransaction":null,"lastFour":"4564","id":"Q2FyZDozOTQxMDQ=","frozen":false,"expirationDate":"08/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"},{"node":{"userAllocation":{"type":"RECURRING","totalPending":0,"totalCleared":3104,"recurringAmount":0,"id":"VXNlckFsbG9jYXRpb246NDE3OTQ1","expiresAt":null,"budget":{"retired":false,"name":"Digital0620","id":"QnVkZ2V0OjQwNTg5","balance":75247,"__typename":"Budget"},"availableFunds":4032,"__typename":"UserAllocation"},"user":{"lastName":"Kwun","id":"VXNlcjo1NDQ1MQ==","firstName":"Julian","displayName":"Julian Kwun","avatarUrl":null,"activeUserAllocation":{"type":"ONE_TIME","totalPending":0,"totalCleared":0,"recurringAmount":null,"id":"VXNlckFsbG9jYXRpb246MzkxODQw","expiresAt":null,"budget":{"name":"Digital0620","id":"QnVkZ2V0OjQwNTg5","balance":75247,"__typename":"Budget"},"availableFunds":0,"__typename":"UserAllocation"},"__typename":"User"},"token":"001.R.20190705123343878067","name":"1","latestTransaction":{"occurredAt":1566814091,"merchantName":"AMAZON PRIME","merchantLogoUrl":"https://s3.amazonaws.com/MD_Assets/merchant_logos/amazon.png","id":"VHJhbnNhY3Rpb246Mjg3YmE2ZGQtM2I0Mi00YTBjLWEyYTEtZWViN2FkNTQ4M2Uy","clearedAt":1566814091,"cleanedMerchantName":"Amazon Prime","__typename":"Transaction"},"lastFour":"1509","id":"Q2FyZDozMjU3Mzc=","frozen":false,"expirationDate":"07/22","cardType":"SUBSCRIPTION","blocked":false,"activationStatus":"ACTIVATED","__typename":"Card"},"__typename":"CardEdge"}],"__typename":"CardConnection"},"__typename":"Company"}}}
    @Override
    public GetCompanyVirtualCardsRsp persistent(String rsp) {
        //data.node.allCards.edges
        JsonObject jsonObject = new JsonParser().parse(rsp).getAsJsonObject().get("data").getAsJsonObject().get("node").getAsJsonObject().get("allCards").getAsJsonObject();
        val list = new ArrayList<VitrualCard>();
        val array = jsonObject.get("edges").getAsJsonArray();
        array.forEach(t -> {
            list.add(new VitrualCard(
                    t.getAsJsonObject().get("node").getAsJsonObject().get("id").getAsString(),
                    t.getAsJsonObject().get("node").getAsJsonObject().get("activationStatus").getAsString(),
                    t.getAsJsonObject().get("node").getAsJsonObject().get("expirationDate").getAsString(),
                    t.getAsJsonObject().get("node").getAsJsonObject().get("frozen").getAsBoolean(),
                    t.getAsJsonObject().get("node").getAsJsonObject().get("cardToken").getAsString(),
                    t.getAsJsonObject().get("node").getAsJsonObject().get("cardType").getAsString(),
                    t.getAsJsonObject().get("node").getAsJsonObject().get("name").getAsString(),
                    t.getAsJsonObject().get("node").getAsJsonObject().get("blocked").getAsBoolean()
            ));
        });
        return new GetCompanyVirtualCardsRsp(
                jsonObject.get("totalCount").getAsLong(),
                jsonObject.get("pageInfo").getAsJsonObject().get("hasNextPage").getAsBoolean(),
                Base64Util.toNameValuePair(jsonObject.get("pageInfo").getAsJsonObject().get("endCursor").getAsString()).getValue(),
                list

        );
    }
}

